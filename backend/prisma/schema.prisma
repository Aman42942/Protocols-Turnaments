generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String                  @id @default(uuid())
  email              String                  @unique
  password           String?
  name               String?
  role               String                  @default("USER")
  avatar             String?
  banned             Boolean                 @default(false)
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  provider           String?
  providerId         String?
  emailVerified      Boolean                 @default(false)
  emailVerifyCode    String?
  emailVerifyExpiry  DateTime?
  resetToken         String?
  resetTokenExpiry   DateTime?
  otpCode            String?
  otpExpiry          DateTime?
  twoFactorEnabled   Boolean                 @default(false)
  twoFactorSecret    String?
  lastLoginAt        DateTime?
  lastLoginIp        String?
  loginAttempts      Int                     @default(0)
  lockedUntil        DateTime?
  riotId             String?
  pubgId             String?
  bgmiId             String?
  freeFireId         String?
  badges             String?
  country            String?
  bio                String?
  socials            String?
  hashedRefreshToken String?
  activityLogs       ActivityLog[]
  notifications      Notification[]
  teams              TeamMember[]
  tournaments        TournamentParticipant[]
  wallet             Wallet?
  invitations        TeamInvitation[]
}

model Tournament {
  id                String                  @id @default(uuid())
  title             String
  description       String?
  game              String
  status            String                  @default("UPCOMING")
  tier              String                  @default("LOW")
  entryFeePerPerson Float                   @default(0)
  prizePool         Float                   @default(0)
  currency          String                  @default("INR")
  startDate         DateTime
  endDate           DateTime?
  maxTeams          Int
  minTeams          Int?
  gameMode          String                  @default("SQUAD")
  format            String                  @default("SINGLE_ELIM")
  scoringEngine     String?
  mapPool           String?
  gameSettings      String?
  rules             String?
  prizeDistribution String?
  roomId            String?
  roomPassword      String?
  slotList          String?
  shareCode         String?                 @unique
  whatsappGroupLink String?
  discordChannelId  String?
  streamUrl         String?
  region            String?
  banner            String?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  collectedFees     Float                   @default(0)
  organizerId       String?
  matches           Match[]
  organizer         Organizer?              @relation(fields: [organizerId], references: [id])
  leaderboard       TournamentLeaderboard[]
  teams             TournamentParticipant[]
}

model Team {
  id                  String                  @id @default(uuid())
  name                String
  logo                String?
  leaderId            String
  inviteCode          String                  @unique
  gameType            String                  @default("PUBG_SQUAD")
  maxMembers          Int                     @default(4)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  matchParticipations MatchParticipation[]
  members             TeamMember[]
  leaderboardEntries  TournamentLeaderboard[]
  tournaments         TournamentParticipant[]
  invitations         TeamInvitation[]
}

model TeamMember {
  id       String   @id @default(uuid())
  teamId   String
  userId   String
  role     String   @default("MEMBER")
  joinedAt DateTime @default(now())
  team     Team     @relation(fields: [teamId], references: [id])
  user     User     @relation(fields: [userId], references: [id])
}

model TeamInvitation {
  id         String   @id @default(uuid())
  teamId     String
  userId     String
  inviterId  String
  status     String   @default("PENDING")
  createdAt  DateTime @default(now())
  team       Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
}

model TournamentParticipant {
  id            String     @id @default(uuid())
  tournamentId  String
  teamId        String?
  userId        String
  status        String     @default("PENDING")
  paymentStatus String     @default("UNPAID")
  paymentId     String?
  registeredAt  DateTime   @default(now())
  team          Team?      @relation(fields: [teamId], references: [id])
  tournament    Tournament @relation(fields: [tournamentId], references: [id])
  user          User       @relation(fields: [userId], references: [id])
}

model Match {
  id             String               @id @default(uuid())
  tournamentId   String
  round          Int
  teamAId        String?
  teamBId        String?
  scoreA         Int?
  scoreB         Int?
  winnerId       String?
  status         String               @default("SCHEDULED")
  startTime      DateTime
  tournament     Tournament           @relation(fields: [tournamentId], references: [id])
  participations MatchParticipation[]
}

model MatchParticipation {
  id        String @id @default(uuid())
  matchId   String
  teamId    String
  placement Int?
  kills     Int    @default(0)
  score     Float  @default(0)
  match     Match  @relation(fields: [matchId], references: [id])
  team      Team   @relation(fields: [teamId], references: [id])

  @@unique([matchId, teamId])
}

model TournamentLeaderboard {
  id            String     @id @default(uuid())
  tournamentId  String
  teamId        String
  totalPoints   Float      @default(0)
  totalKills    Int        @default(0)
  matchesPlayed Int        @default(0)
  rank          Int        @default(0)
  updatedAt     DateTime   @updatedAt
  team          Team       @relation(fields: [teamId], references: [id])
  tournament    Tournament @relation(fields: [tournamentId], references: [id])

  @@unique([tournamentId, teamId])
  @@index([tournamentId, totalPoints(sort: Desc)])
}

model Wallet {
  id            String        @id @default(uuid())
  userId        String        @unique
  balance       Float         @default(0)
  currency      String        @default("COIN")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  frozenBalance Float         @default(0)
  transactions  Transaction[]
  user          User          @relation(fields: [userId], references: [id])
}

model Transaction {
  id             String   @id @default(uuid())
  walletId       String
  type           String
  amount         Float
  currency       String   @default("INR") // INR, USD, COIN
  conversionRate Float    @default(1.0)
  status         String   @default("PENDING")
  method         String?
  reference      String?
  description    String?
  createdAt      DateTime @default(now())
  metadata       String?
  wallet         Wallet   @relation(fields: [walletId], references: [id])
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  type      String   @default("info")
  read      Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model ActivityLog {
  id        String   @id @default(uuid())
  adminId   String
  action    String
  targetId  String?
  details   String?
  ipAddress String?
  createdAt DateTime @default(now())
  admin     User     @relation(fields: [adminId], references: [id])
}

model ThemeSettings {
  id              String   @id @default(uuid())
  isActive        Boolean  @default(true)
  siteName        String   @default("Pro Tournaments")
  logoUrl         String?
  faviconUrl      String?
  primaryColor    String   @default("#ff4f4f")
  secondaryColor  String   @default("#1f1f1f")
  accentColor     String   @default("#3b82f6")
  backgroundColor String   @default("#000000")
  heroTitle       String   @default("Dominate the Arena")
  heroSubtitle    String   @default("Join the ultimate esports tournaments and win big prizes.")
  heroImageUrl    String?
  customCss       String?
  updatedAt       DateTime @updatedAt
}

model ContentPage {
  id          String   @id @default(uuid())
  slug        String   @unique
  title       String
  content     String
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Announcement {
  id        String   @id @default(uuid())
  title     String
  message   String
  type      String   @default("INFO")
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SystemConfig {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}

model DailyStat {
  id            String   @id @default(uuid())
  date          DateTime @unique
  newUsers      Int      @default(0)
  activeUsers   Int      @default(0)
  revenue       Float    @default(0)
  matchesPlayed Int      @default(0)
  createdAt     DateTime @default(now())
}

model EscrowPool {
  id             String    @id @default(uuid())
  tournamentId   String    @unique
  totalCollected Float     @default(0)
  platformFeeRaw Float     @default(0)
  netPrizePool   Float     @default(0)
  status         String    @default("OPEN")
  distributedAt  DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model ResultLock {
  id             String    @id @default(uuid())
  matchId        String    @unique
  lockedBy       String
  lockedAt       DateTime  @default(now())
  isOverridden   Boolean   @default(false)
  overrideBy     String?
  overrideAt     DateTime?
  overrideReason String?
}

model Organizer {
  id           String          @id @default(uuid())
  userId       String          @unique
  name         String
  slug         String          @unique
  logoUrl      String?
  description  String?
  website      String?
  contactEmail String?
  plan         String          @default("FREE")
  isVerified   Boolean         @default(false)
  isActive     Boolean         @default(true)
  panNumber    String?
  gstNumber    String?
  tnc          String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  theme        OrganizerTheme?
  tournaments  Tournament[]
}

model OrganizerTheme {
  id           String    @id @default(uuid())
  organizerId  String    @unique
  primaryColor String    @default("#6366f1")
  accentColor  String    @default("#8b5cf6")
  bgColor      String    @default("#0a0a0f")
  textColor    String    @default("#ffffff")
  logoUrl      String?
  faviconUrl   String?
  bannerUrl    String?
  fontFamily   String    @default("Inter")
  heroTitle    String?
  heroSubtitle String?
  footerText   String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  organizer    Organizer @relation(fields: [organizerId], references: [id])
}

model ComplianceAuditLog {
  id           String   @id @default(uuid())
  organizerId  String
  tournamentId String?
  event        String
  details      String
  ipAddress    String?
  performedBy  String
  createdAt    DateTime @default(now())

  @@index([organizerId])
  @@index([tournamentId])
}

model GlobalTheme {
  id                 String   @id @default(uuid())
  mode               String   @default("DARK") // DARK, LIGHT, NEON, MINIMAL
  primaryColor       String   @default("#FF5733")
  secondaryColor     String   @default("#1F1F1F")
  backgroundColor    String   @default("#000000")
  textColor          String   @default("#FFFFFF")
  fontFamily         String   @default("Inter")
  borderRounding     String   @default("0.5rem") // 0px, 0.5rem, 9999px
  animationSpeed     String   @default("normal") // slow, normal, fast
  buttonStyle        String   @default("solid")  // solid, outline, ghost
  glassmorphism      Boolean  @default(false)
  backgroundStyle    String   @default("solid")  // solid, gradient, mesh
  updatedAt          DateTime @updatedAt
}

model SiteContent {
  id              String   @id @default(uuid())
  key             String   @unique // e.g., "HERO_TITLE", "LOGO_URL"
  value           String   @db.Text
  type            String   // TEXT, IMAGE_URL, HTML
  updatedAt       DateTime @updatedAt
}

model ComponentLayout {
  id              String   @id @default(uuid())
  componentId     String   @unique // e.g., "FEATURED_TOURNAMENTS", "TESTIMONIALS"
  isVisible       Boolean  @default(true)
  displayOrder    Int      @default(0)
}

model CustomFeature {
  id          String   @id @default(uuid())
  title       String
  description String?  @db.Text
  icon        String?  // Name of the lucide icon or a URL
  imageUrl    String?  // Optional image for the feature
  type        String   @default("CARD") // CARD, HERO, TEXT_BLOCK, STAT_BOX
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AdSlide {
  id           String    @id @default(uuid())
  title        String
  description  String?   @db.Text
  mediaType    String    @default("IMAGE") // IMAGE, VIDEO
  mediaUrl     String    @db.Text
  ctaLink      String?   @db.Text
  ctaText      String?   @default("Learn More")
  openInNewTab Boolean   @default(false)
  isActive     Boolean   @default(true)
  displayOrder Int       @default(0)
  startDate    DateTime?
  endDate      DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}
